#!/bin/sh
# Start of the pre-push hook

# Color codes for terminal output
CYAN='\033[0;36m'
GREEN='\033[0;32m'
RED='\033[0;31m'
BOLD='\033[1m'
RESET='\033[0m'

# Start message
echo "${CYAN}${BOLD}üöÄ Husky pre-push hook is running...${RESET}"

# Check if tests exist
if [ -d "src/test" ] || [ -f "src/**/*.test.*" ] || [ -f "src/**/*.spec.*" ]; then
    echo "${CYAN}Tests found, running them...${RESET}"
    
    # Run tests before push
    npm run test
    TEST_STATUS=$?
    if [ $TEST_STATUS -ne 0 ]; then
        echo "${RED}${BOLD}‚ùå Tests failed! Push aborted.${RESET}"
        exit 1
    fi

    echo "${CYAN}Running test coverage...${RESET}"
    npm run test:coverage
    COVERAGE_STATUS=$?
    if [ $COVERAGE_STATUS -ne 0 ]; then
        echo "${RED}${BOLD}‚ùå Test coverage failed!${RESET}"
        exit 1
    fi
else
    echo "${CYAN}No tests found, skipping test execution...${RESET}"
fi

# End message
echo "${GREEN}${BOLD}‚úÖ  Husky pre-push hook completed successfully!${RESET}"
